<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timesheet Calendar</title>
  <style>
body {
  font-family: 'Segoe UI', sans-serif;
  background-color: #323232;
  color: #e0e0e0;
  margin: 12px;
}

.annotation-block {
  border: 1px solid #bbbbbb;
  box-shadow: 0 0 5px rgba(58, 154, 237, 0.2);
  padding: 8px;
  margin-bottom: 16px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

td.title {
  white-space: nowrap;
  padding: 2px 10px 2px 0;
  color: #cccccc;
  font-size: 0.8em;
  vertical-align: top;
  width: 160px;
}

.value {
  color: #bbbbbb;
  background-color: #1e1e1e;
  font-size: 0.8em;
  vertical-align: top;
  padding: 3px;
  margin: 3px;
}

.translated {
  margin-top: 8px;
}

.translated span {
  font-weight: bold;
  color: #87cefa;
}

.translated-text {
  color: #dddddd;
  font-size: 0.8em;
  background-color: #1e1e1e;
  border-left: 4px solid #3a9aed; 
  padding: 3px;
  margin: 3px;
  padding-left: 6px;
  margin-bottom: 6px;
}
  </style>
</head>
<body>
  <h1>Timesheet</h1>
  <div id="timesheet-container">Loading...</div>

<script>
try {
    const raw = expression.evaluate("CASE WHEN XXXX is NULL THEN '{}' WHEN XXXX is not NULL THEN to_json(XXXX) END");
    const timesheetData = JSON.parse(raw);
    const container = document.getElementById('timesheet-container');

    if (Object.keys(timesheetData).length === 0) {
        container.textContent = "Null";
    } else {
        container.innerHTML = '';
        timesheetData.forEach(entry => {
            const div = document.createElement('div');
            div.className = 'annotation-block';

            let start = "";
            let end = "";

            if (entry.starteventinterpretation && !entry.starteventinterpretation.includes('(') && !entry.starteventinterpretation.includes(')')) {
                start += `${entry.starteventinterpretation} ( `;
            }

            if (entry.endeventinterpretation && !entry.endeventinterpretation.includes('(') && !entry.endeventinterpretation.includes(')')) {
                end += `${entry.endeventinterpretation} ( `;
            }

            if (entry.starttime && !entry.starttime.includes('(') && !entry.starttime.includes(')')) {
                start += `${entry.starttime} `;
            }

            if (entry.endtime && !entry.endtime.includes('(') && !entry.endtime.includes(')')) {
                end += `${entry.endtime} `;
            }

            if (entry.starteventinterpretation && !entry.starteventinterpretation.includes('(') && !entry.starteventinterpretation.includes(')')) {
                start += `/ `;
            }

            if (entry.endeventinterpretation && !entry.endeventinterpretation.includes('(') && !entry.endeventinterpretation.includes(')')) {
                end += `/ `;
            }

            if (entry.startevent && !entry.startevent.includes('(') && !entry.startevent.includes(')')) {
                start += `${entry.startevent} `;
            }

            if (entry.endevent && !entry.endevent.includes('(') && !entry.endevent.includes(')')) {
                end += `${entry.endevent} `;
            }

            if (entry.starttimerelativeevent && !entry.starttimerelativeevent.includes('(') && !entry.starttimerelativeevent.includes(')')) {
                start += `${entry.starttimerelativeevent} `;
            }

            if (entry.endtimerelativeevent && !entry.endtimerelativeevent.includes('(') && !entry.endtimerelativeevent.includes(')')) {
                end += `${entry.endtimerelativeevent} `;
            }

            if (entry.starteventinterpretation && !entry.starteventinterpretation.includes('(') && !entry.starteventinterpretation.includes('(')) {
                start += `)`;
            }

            if (entry.endeventinterpretation && !entry.endeventinterpretation.includes(')') && !entry.endeventinterpretation.includes(')')) {
                end += `)`;
            }

            let timeRange = start + " -> " + end;
            day = `${entry.day}${entry.daytil ? ` till ${entry.daytil}` : ''}`;

            div.innerHTML = `
        <table>
          <tr>
            <td class="title">Valid Days</td>
            <td><div class="value">${day}</div></td>
          </tr>
          <tr>
            <td class="title">Excluded</td>
            <td><div class="value">${entry.excluded}</div></td>
          </tr>
          <tr>
            <td class="title">Date Range</td>
            <td><div class="value">${entry.startdate} to ${entry.enddate}</div></td>
          </tr>
          <tr>
            <td class="title">Time Reference</td>
            <td><div class="value">${entry.timereference}</div></td>
          </tr>
          <tr>
            <td class="title">Time Range</td>
            <td><div class="value">${timeRange}</div></td>
          </tr>
          <tr>
            <td class="title">DST Adjustment</td>
            <td><div class="value">${entry.daylightsavingadjust}</div></td>
          </tr>
        </table>
      `;

            container.appendChild(div);
        });
    }
} catch (e) {
    document.getElementById('timesheet-container').textContent = "Error: " + e;
}
</script>

</body>
</html>
